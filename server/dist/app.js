!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{type:e,payload:t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PICK="PICK",e.SUBMIT="SUBMIT"}(t.HatSocketClientEventEnum||(t.HatSocketClientEventEnum={})),function(e){e.OPEN_HAT="OPEN_HAT",e.CLOSE_HAT="CLOSE_HAT",e.SET_THEME="SET_THEME",e.SET_TIME="SET_TIME",e.RESET="RESET"}(t.HatSocketHatMasterClientEventEnum||(t.HatSocketHatMasterClientEventEnum={})),function(e){e.THEME_SET="THEME_SET",e.TIME_SET="TIME_SET",e.PICK="PICK",e.WAIT="WAIT",e.SUBMISSION_RECEIVED="SUBMISSION_RECEIVED",e.NO_SUBMISSIONS_LEFT="NO_SUBMISSIONS_LEFT",e.ERROR="ERROR",e.RESET="RESET",e.HAT_OPENED="HAT_OPENED",e.HAT_CLOSED="HAT_CLOSED"}(t.HatSocketServerEventEnum||(t.HatSocketServerEventEnum={})),t.HatSocketHatMasterServerEventEnum||(t.HatSocketHatMasterServerEventEnum={})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=n(4),i=n(5),a=o(),u=r.createServer(a),s=i(u,{path:"/virtual-hat/socket-io"}),c=n(6),E=new(n(10).default)(s),l=new c.default(s);s.on("connection",(function(e){l.onConnection(e),E.onConnection(e)})),a.get("/",(function(e,t){t.sendStatus(200)}));var S=process.env.PORT||3001;u.listen(S,(function(){return console.log("I'm listenin on "+S+"!")}))},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("socket.io")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(8),i=n(9),a=n(0),u=n(1),s=function(){function e(e){this.players=[],this.hatMaster=void 0,this.socketServer=e,this.currentTurn=0}return e.prototype.addPlayer=function(e){return console.log("Adding new player "+e.id),this.players.push(e),!0},e.prototype.removePlayer=function(e){console.log("Removing player "+e);var t=this.players.findIndex((function(t){return t.id===e}));return-1!==t&&(this.players.splice(t,1),this.hatMaster===e&&this.unsetHatMaster(),!0)},e.prototype.registerPlayer=function(e,t){if(console.log("Registering player "+e+" to "+t),!this.players.find((function(e){return e.nickname===t}))){var n=this.players.find((function(t){return t.id===e}));return!!n&&(n.nickname=t,!0)}return!1},e.prototype.setHatMaster=function(e){this.hatMaster=e.id,console.log("New hat master is "+this.hatMaster),e.emit("player",i.default(o.PlayerSocketServerEventEnum.HAT_MASTER))},e.prototype.unsetHatMaster=function(){this.hatMaster=void 0,console.log("Removed hat master"),this.players.length>0&&this.setHatMaster(this.players[0].socket)},e.prototype.onConnection=function(e){var t=this;e.on("player",(function(n){return t.handleSocketEvent(e,n)})),e.on("disconnect",(function(){return t.removePlayer(e.id)}));var n=new r.default(e);this.addPlayer(n)},e.prototype.handleSocketEvent=function(e,t){var n=t.type,r=t.payload;switch(console.log("[PLAYER:"+n+"] "+JSON.stringify(r)),n){case o.PlayerSocketClientEventEnum.REGISTER:this.onRegister(e,r);break;case o.PlayerSocketClientEventEnum.NEXT_TURN:this.nextTurn(e)}},e.prototype.nextTurn=function(e){var t=this.currentTurn%this.players.length;e.emit("hat",a.default(u.HatSocketServerEventEnum.WAIT)),e.broadcast.emit("hat",a.default(u.HatSocketServerEventEnum.WAIT)),this.players[t].socket.emit("player",i.default(o.PlayerSocketServerEventEnum.YOUR_PICK))},e.prototype.onRegister=function(e,t){var n=e.id;this.registerPlayer(n,t)?(console.log("Registered player "+e.id+" to "+t),e.emit("player",i.default(o.PlayerSocketServerEventEnum.REGISTERED)),void 0===this.hatMaster&&this.setHatMaster(e)):(console.log(t+" is taken"),e.emit("player",i.default(o.PlayerSocketServerEventEnum.ERROR,{message:t+" is taken!"})))},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._nickname=void 0,this.socket=e,this._id=e.id}return Object.defineProperty(e.prototype,"nickname",{get:function(){return this._nickname},set:function(e){this._nickname=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.id===e.id},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.REGISTER="REGISTER",e.NEXT_TURN="NEXT_TURN"}(t.PlayerSocketClientEventEnum||(t.PlayerSocketClientEventEnum={})),function(e){e.REGISTERED="REGISTERED",e.HAT_MASTER="HAT_MASTER",e.YOUR_PICK="YOUR_PICK",e.ERROR="ERROR"}(t.PlayerSocketServerEventEnum||(t.PlayerSocketServerEventEnum={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{type:e,payload:t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),o=n(1),i=n(0),a=function(){function e(e){this.isHatOpen=!1,this.time=120,this.socketServer=e,this.hat=new r.default,this.onConnection=this.onConnection.bind(this)}return e.prototype.onConnection=function(e){var t=this;e.on("hat",(function(n){return t.handleSocketEvent(e,n)}))},e.prototype.handleSocketEvent=function(e,t){var n=t.type,a=t.payload;switch(console.log("[HAT:"+n+"] "+JSON.stringify(a)),n){case o.HatSocketClientEventEnum.PICK:e.broadcast.emit("hat",i.default(o.HatSocketServerEventEnum.WAIT)),e.emit("hat",i.default(o.HatSocketServerEventEnum.PICK,this.hat.getSubmission(e.id)));break;case o.HatSocketClientEventEnum.SUBMIT:e.broadcast.emit("hat",i.default(o.HatSocketServerEventEnum.SUBMISSION_RECEIVED)),e.emit("hat",i.default(o.HatSocketServerEventEnum.SUBMISSION_RECEIVED)),this.hat.addSubmission(a);break;case o.HatSocketHatMasterClientEventEnum.RESET:this.hat=new r.default,e.broadcast.emit("hat",i.default(o.HatSocketServerEventEnum.RESET)),e.emit("hat",i.default(o.HatSocketServerEventEnum.RESET));break;case o.HatSocketHatMasterClientEventEnum.SET_THEME:this.hat.theme=a,e.broadcast.emit("hat",i.default(o.HatSocketServerEventEnum.THEME_SET,a)),e.emit("hat",i.default(o.HatSocketServerEventEnum.THEME_SET,a));break;case o.HatSocketHatMasterClientEventEnum.OPEN_HAT:e.broadcast.emit("hat",i.default(o.HatSocketServerEventEnum.HAT_OPENED)),e.emit("hat",i.default(o.HatSocketServerEventEnum.HAT_OPENED));break;case o.HatSocketHatMasterClientEventEnum.CLOSE_HAT:e.broadcast.emit("hat",i.default(o.HatSocketServerEventEnum.HAT_CLOSED)),e.emit("hat",i.default(o.HatSocketServerEventEnum.HAT_CLOSED))}},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.submissions=[]}return e.prototype.addSubmission=function(e){console.log(e),this.submissions.push(e)},e.prototype.removeSubmission=function(e){return console.log(e),this.submissions.splice(e,1)[0]},e.prototype.getSubmission=function(e){if(0===this.submissions.length)return!1;var t=this.submissions.findIndex((function(t){return t.author!==e}));return-1===t&&(t=0),this.removeSubmission(t)},e}();t.default=r}]);
//# sourceMappingURL=app.js.map